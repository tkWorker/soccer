<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Soccer Tactics Board</title>
<style>
body{margin:0;background:#eee}
#toolbar{display:flex;gap:6px;padding:8px;background:#222;color:#fff}
button{padding:6px 10px}
canvas{display:block;margin:auto;background:white}
</style>
</head>
<body>

<div id="toolbar">
<button onclick="mode='move'">ğŸ‘¤ç§»å‹•</button>
<button onclick="mode='pen'">âœé‰›ç­†</button>
<button onclick="mode='eraser'">ğŸ§½æ¶ˆã—ã‚´ãƒ </button>
<button onclick="set4213()">4-2-1-3</button>
<button onclick="resetAll()">ãƒªã‚»ãƒƒãƒˆ</button>
<button onclick="saveLocal()">ä¿å­˜</button>
<button onclick="loadLocal()">èª­è¾¼</button>
</div>

<canvas id="c" width="1200" height="700"></canvas>

<script>
const c=document.getElementById("c"),ctx=c.getContext("2d");
let mode="move",drawing=false,dragging=false,selecting=false;
let dragByLeft=false,dragByRight=false;
let startPos=null,selectionRect=null;

const PLAYER_R=16,BALL_R=12,HIT_R=20;
let paths=[],ball={x:600,y:350};
let players=[],enemies=[],selected=[];

/* ãƒ•ã‚©ãƒ¼ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
function set4213(){
 const base=[
  {x:120,y:350},
  {x:260,y:150},{x:260,y:280},{x:260,y:420},{x:260,y:550},
  {x:480,y:280},{x:480,y:420},
  {x:650,y:300},
  {x:820,y:200},{x:920,y:350},{x:820,y:500}
 ];
 players=base.map(p=>({x:1200-p.x,y:p.y}));
 enemies=base.map(p=>({x:p.x-40,y:p.y}));
 draw();
}
function resetAll(){paths=[];set4213();}

/* æç”» */
function drawField(){
 ctx.clearRect(0,0,c.width,c.height);
 ctx.strokeRect(50,50,1100,600);
 ctx.beginPath();ctx.moveTo(600,50);ctx.lineTo(600,650);ctx.stroke();
 ctx.beginPath();ctx.arc(600,350,80,0,Math.PI*2);ctx.stroke();
 ctx.strokeRect(50,300,25,100);
 ctx.strokeRect(1125,300,25,100);
}
function drawCircle(p,r,col){
 ctx.beginPath();ctx.arc(p.x,p.y,r,0,Math.PI*2);
 ctx.fillStyle=col;ctx.fill();ctx.stroke();
}
function draw(){
 drawField();
 paths.forEach(p=>{
  ctx.beginPath();
  p.points.forEach((pt,i)=>i?ctx.lineTo(pt.x,pt.y):ctx.moveTo(pt.x,pt.y));
  ctx.stroke();
 });
 players.forEach(p=>drawCircle(p,PLAYER_R,selected.includes(p)?"#0ff":"blue"));
 enemies.forEach(p=>drawCircle(p,PLAYER_R,selected.includes(p)?"#faa":"red"));
 drawCircle(ball,BALL_R,selected.includes(ball)?"#555":"black");

 if(selectionRect){
  ctx.setLineDash([6,4]);
  ctx.strokeRect(selectionRect.x,selectionRect.y,selectionRect.w,selectionRect.h);
  ctx.setLineDash([]);
 }
}

/* util */
function pos(e){
 const r=c.getBoundingClientRect();
 return {x:e.clientX-r.left,y:e.clientY-r.top};
}
function hit(o,p){return Math.hypot(o.x-p.x,o.y-p.y)<HIT_R}
function hitPath(pa,p){return pa.points.some(pt=>Math.hypot(pt.x-p.x,pt.y-p.y)<10)}

/* æ“ä½œ */
c.onpointerdown=e=>{
 const p=pos(e); startPos=p;

 if(mode==="pen"){drawing=true;paths.push({points:[p]});return;}
 if(mode==="eraser"){paths=paths.filter(pa=>!hitPath(pa,p));draw();return;}

 if(e.button===2){ // å³ã‚¯ãƒªãƒƒã‚¯
  selecting=true; dragByRight=true; dragByLeft=false;
  selected=[];
  return;
 }

 // å·¦ã‚¯ãƒªãƒƒã‚¯
 dragByLeft=true; dragByRight=false;

 if(selected.some(o=>hit(o,p))){
  dragging=true;
  return;
 }

 selected=[];
 [...players,...enemies,ball].forEach(o=>{if(hit(o,p))selected.push(o)});
 dragging=selected.length>0;
};

c.onpointermove=e=>{
 const p=pos(e);

 if(drawing){paths.at(-1).points.push(p);draw();return;}

 if(selecting){
  selectionRect={
   x:Math.min(startPos.x,p.x),
   y:Math.min(startPos.y,p.y),
   w:Math.abs(p.x-startPos.x),
   h:Math.abs(p.y-startPos.y)
  };
  selected=[];
  [...players,...enemies,ball].forEach(o=>{
   if(o.x>selectionRect.x&&o.x<selectionRect.x+selectionRect.w&&
      o.y>selectionRect.y&&o.y<selectionRect.y+selectionRect.h)
      selected.push(o);
  });
 }

 if(dragging){
  const dx=p.x-startPos.x,dy=p.y-startPos.y;
  selected.forEach(o=>{o.x+=dx;o.y+=dy});
  startPos=p;
 }

 draw();
};

c.onpointerup=()=>{
 drawing=false;dragging=false;selecting=false;selectionRect=null;
 if(dragByLeft) selected=[];   // â˜… å·¦ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†ã§è§£é™¤
 dragByLeft=false;dragByRight=false;
 draw();
};

c.oncontextmenu=e=>e.preventDefault();

/* ä¿å­˜ */
function saveLocal(){
 localStorage.setItem("tactics",JSON.stringify({players,enemies,ball,paths}));
 alert("ä¿å­˜ã—ã¾ã—ãŸ");
}
function loadLocal(){
 const d=localStorage.getItem("tactics");
 if(d){({players,enemies,ball,paths}=JSON.parse(d));draw();}
}

set4213();
</script>
</body>
</html>
